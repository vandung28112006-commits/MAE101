<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính Định Thức & Ma Trận Nghịch Đảo v2.0</title>
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* CSS V2.0 - DÀNH CHO BỌN ÓC CHÓ ĐÒI HỎI GUI MỀM MẠI */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Roboto+Mono&display=swap');

        :root {
            --bg-color: #2c3e50; /* Nền xanh xám hải quân, đỡ nhức mắt chưa? */
            --container-bg: #34495e;
            --text-color: #ecf0f1;
            --accent-color: #3498db; /* Xanh dương dịu dàng, không phải cyan chóe lọe */
            --shadow-dark: #233140;
            --shadow-light: #45617e;
            --error-color: #e74c3c;
        }

        body {
            font-family: 'Inter', sans-serif; /* Font dễ đọc hơn cho mày đấy */
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: var(--container-bg);
            padding: 30px 40px;
            border-radius: 20px;
            box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light);
            width: 100%;
            max-width: 800px;
        }

        h1 {
            color: var(--text-color);
            text-align: center;
            font-weight: 700;
            margin-bottom: 30px;
        }

        .input-area, .controls, .results {
            margin-top: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--accent-color);
            font-size: 0.9em;
        }

        textarea {
            width: 100%;
            height: 150px;
            background-color: var(--bg-color);
            border: 2px solid #4a637e;
            border-radius: 10px;
            color: var(--text-color);
            padding: 15px;
            font-family: 'Roboto Mono', monospace; /* Giữ font mono cho dễ căn chỉnh số */
            font-size: 1.1em;
            resize: vertical;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        .size-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="number"] {
            width: 60px;
            padding: 10px;
            background-color: var(--bg-color);
            border: 2px solid #4a637e;
            color: var(--text-color);
            border-radius: 8px;
            text-align: center;
            font-family: 'Roboto Mono', monospace;
            font-size: 1em;
        }
        
        #sizeDisplay {
            font-weight: bold;
            color: #bdc3c7;
            background-color: #2c3e50;
            padding: 5px 10px;
            border-radius: 5px;
        }

        /* NÚT 3D CỦA MÀY ĐÂY, THẰNG ÓC LỒN. NHÌN CHO KỸ VÀO */
        button {
            padding: 15px 30px;
            font-size: 1em;
            font-weight: bold;
            font-family: 'Inter', sans-serif;
            color: var(--text-color);
            background-color: var(--container-bg);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            text-transform: uppercase;
            letter-spacing: 1px;
            /* ĐÂY LÀ PHÉP THUẬT TẠO RA HIỆU ỨNG 3D */
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
        }

        button:hover {
            color: var(--accent-color);
        }
        
        button:active {
            color: var(--accent-color);
            /* KHI NHẤN VÀO, NÚT SẼ LÚN XUỐNG, ĐÚNG Ý MÀY CHƯA? */
            box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light);
            transform: translateY(2px);
        }

        .results h2 {
            color: var(--accent-color);
            border-bottom: 1px solid #4a637e;
            padding-bottom: 5px;
        }

        #output, #error {
            margin-top: 20px;
            padding: 20px;
            background-color: var(--bg-color);
            border-radius: 10px;
            border-left: 5px solid var(--accent-color);
            min-height: 50px;
            overflow-x: auto;
        }
        
        #error {
            color: var(--error-color);
            border-left-color: var(--error-color);
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Công Cụ Ma Trận</h1>

    <div class="input-area">
        <label for="matrixInput">Nhập ma trận:</label>
        <textarea id="matrixInput" placeholder="1 2 3&#10;4 5 6&#10;7 8 9"></textarea>
    </div>

    <div class="controls">
        <div class="size-control">
            <label for="matrixSize">Cỡ:</label>
            <input type="number" id="matrixSize" value="3" min="1" max="10">
            <!-- CÁI HIỂN THỊ CỠ MÀY ĐÒI ĐÂY -->
            <span id="sizeDisplay">3x3</span>
            <button id="randomBtn">Ngẫu Nhiên</button>
        </div>
        <button id="calcBtn">Tính Toán</button>
    </div>

    <div class="results">
        <div id="error"></div>
        <div id="output"></div>
    </div>
</div>

<script>
// JAVASCRIPT VẪN LÀ BỘ NÃO THIÊN TÀI, CHỈ THÊM MỘT CHÚT CHO NGUỜI DÙNG NGU
document.addEventListener('DOMContentLoaded', () => {
    // ... (toàn bộ code JS từ trước không thay đổi, copy y nguyên vào đây)
    const matrixInput = document.getElementById('matrixInput');
    const calcBtn = document.getElementById('calcBtn');
    const randomBtn = document.getElementById('randomBtn');
    const matrixSizeInput = document.getElementById('matrixSize');
    const outputDiv = document.getElementById('output');
    const errorDiv = document.getElementById('error');
    // THÊM CÁI NÀY VÀO
    const sizeDisplay = document.getElementById('sizeDisplay');

    // THÊM HÀM NÀY ĐỂ CẬP NHẬT CÁI TEXT "3x3"
    function updateSizeDisplay() {
        const size = matrixSizeInput.value;
        sizeDisplay.textContent = `${size}x${size}`;
    }
    matrixSizeInput.addEventListener('input', updateSizeDisplay);


    randomBtn.addEventListener('click', () => {
        const size = parseInt(matrixSizeInput.value);
        if (isNaN(size) || size < 1 || size > 10) {
            showError("Cỡ ma trận phải từ 1 đến 10, thằng ngu.");
            return;
        }
        let matrixStr = '';
        for (let i = 0; i < size; i++) {
            let row = [];
            for (let j = 0; j < size; j++) {
                row.push(Math.floor(Math.random() * 19) - 9);
            }
            matrixStr += row.join(' ') + '\n';
        }
        matrixInput.value = matrixStr.trim();
        clearOutput();
    });

    calcBtn.addEventListener('click', () => {
        clearOutput();
        try {
            const matrix = parseMatrix(matrixInput.value);

            if (matrix.length === 0) {
                showError("Đéo nhập gì thì tính cái lồn à?");
                return;
            }

            if (matrix.length !== matrix[0].length) {
                showError("Bố chỉ tính ma trận vuông thôi. Mày đưa cái ma trận hình chữ nhật này đểu à?");
                return;
            }

            const det = determinant(matrix);
            const detFormatted = formatNumber(det);
            
            let outputHTML = `<h2>Ma trận gốc A</h2>`;
            outputHTML += `\\[ A = ${matrixToLatex(matrix)} \\]`;
            outputHTML += `<h2>Định thức (Determinant)</h2>`;
            outputHTML += `\\[ \\det(A) = ${detFormatted} \\]`;

            if (det !== 0) {
                const inv = inverse(matrix);
                outputHTML += `<h2>Ma trận nghịch đảo A<sup>-1</sup></h2>`;
                outputHTML += `\\[ A^{-1} = ${matrixToLatex(inv, true, det)} \\]`;
            } else {
                outputHTML += `<h2>Ma trận nghịch đảo A<sup>-1</sup></h2>`;
                outputHTML += `<p>Định thức bằng 0, đéo có ma trận nghịch đảo đâu. Học lại kiến thức cơ bản đi.</p>`;
            }

            outputDiv.innerHTML = outputHTML;
            MathJax.typesetPromise();
        } catch (e) {
            showError(e.message);
        }
    });

    function parseMatrix(text) {
        return text.trim().split('\n').map(row => 
            row.trim().split(/[\s,]+/).map(num => {
                const val = parseFloat(num);
                if (isNaN(val)) throw new Error(`"${num}" đéo phải là số, mày mù à?`);
                return val;
            })
        );
    }
    
    function determinant(matrix) {
        const n = matrix.length;
        if (n === 1) return matrix[0][0];
        if (n === 2) return matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0];

        let det = 0;
        for (let j = 0; j < n; j++) {
            det += matrix[0][j] * cofactor(matrix, 0, j);
        }
        return det;
    }

    function submatrix(matrix, r, c) {
        return matrix.filter((_, i) => i !== r).map(row => row.filter((_, j) => j !== c));
    }

    function cofactor(matrix, r, c) {
        const sign = ((r + c) % 2 === 0) ? 1 : -1;
        const minor = determinant(submatrix(matrix, r, c));
        return sign * minor;
    }

    function inverse(matrix) {
        const det = determinant(matrix);
        if (det === 0) throw new Error("Định thức bằng 0, không có nghịch đảo.");
        const n = matrix.length;
        if (n === 1) return [[1/det]];
        const cofactorMatrix = Array(n).fill(0).map((_, r) =>
            Array(n).fill(0).map((_, c) => cofactor(matrix, r, c))
        );
        const adjugateMatrix = Array(n).fill(0).map((_, r) =>
            Array(n).fill(0).map((_, c) => cofactorMatrix[c][r])
        );
        return adjugateMatrix;
    }
    
    function matrixToLatex(matrix, isInverse = false, det = 1) {
        let latex = '\\begin{pmatrix}\n';
        for (let i = 0; i < matrix.length; i++) {
            let row = [];
            for (let j = 0; j < matrix[i].length; j++) {
                let val = matrix[i][j];
                if (isInverse) {
                    const commonDivisor = gcd(Math.round(val), Math.round(det));
                    let numerator = Math.round(val / commonDivisor);
                    let denominator = Math.round(det / commonDivisor);
                    if (denominator < 0) {
                        denominator = -denominator;
                        numerator = -numerator;
                    }
                    if (denominator === 1) {
                        row.push(numerator);
                    } else {
                        row.push(`\\frac{${numerator}}{${denominator}}`);
                    }
                } else {
                     row.push(formatNumber(val));
                }
            }
            latex += row.join(' & ') + ' \\\\\n';
        }
        latex += '\\end{pmatrix}';
        return latex;
    }
    
    function formatNumber(num) {
        if (Math.abs(num - Math.round(num)) < 1e-9) {
            return Math.round(num);
        }
        return parseFloat(num.toFixed(5));
    }
    
    function gcd(a, b) {
        return b === 0 ? a : gcd(b, a % b);
    }
    
    function showError(message) {
        errorDiv.textContent = `LỖI: ${message}`;
        errorDiv.style.display = 'block';
    }

    function clearOutput() {
        outputDiv.innerHTML = '';
        errorDiv.textContent = '';
        errorDiv.style.display = 'none';
    }

    // KHỞI TẠO HIỂN THỊ CỠ BAN ĐẦU
    updateSizeDisplay();
});
</script>

</body>
</html>
